{"version":3,"file":"js/addon-entry-paint-gradient-maker.js","sources":["webpack://GUI/./src/addons/addons/paint-gradient-maker/style.css","webpack://GUI/./src/addons/addons/paint-gradient-maker/fill-complex-gradient-enabled.svg","webpack://GUI/./src/addons/addons/paint-gradient-maker/add.svg","webpack://GUI/./src/addons/addons/paint-gradient-maker/delete.svg","webpack://GUI/./src/addons/addons/paint-gradient-maker/_runtime_entry.js","webpack://GUI/./src/addons/addons/paint-gradient-maker/userscript.js"],"sourcesContent":["exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".paintGradientMakerPopup {\\r\\n  box-sizing: border-box;\\r\\n  width: 528px;\\r\\n  max-height: min(800px, 80vh);\\r\\n  max-width: 85%;\\r\\n  margin-top: 12vh;\\r\\n  overflow-y: auto;\\r\\n  margin-left: auto;\\r\\n  margin-right: auto;\\r\\n}\\r\\n\\r\\n.paintGradientMakerPopupContent {\\r\\n  padding: 1.5rem 2.25rem;\\r\\n}\\r\\n\\r\\n.paintGradientMakerPopupDisplay {\\r\\n  width: 420px;\\r\\n  height: 150px;\\r\\n  display: flex;\\r\\n  justify-content: center;\\r\\n  align-items: center;\\r\\n  margin: 15px 15px 0 15px;\\r\\n  border: solid 1px var(--ui-black-transparent);\\r\\n  border-radius: 5px 5px 0 0;\\r\\n}\\r\\n\\r\\n.paintGradientMakerPopupDraggables {\\r\\n  width: 420px;\\r\\n  height: 40px;\\r\\n  position: relative;\\r\\n  display: flex;\\r\\n  justify-content: center;\\r\\n  align-items: center;\\r\\n  margin: 0 15px 15px 15px;\\r\\n  border: solid 1px var(--ui-black-transparent);\\r\\n  border-top: none;\\r\\n  border-radius: 0 0 5px 5px;\\r\\n  background: var(--ui-tertiary);\\r\\n}\\r\\n\\r\\n.paintGradientMakerPopupSettings {\\r\\n  border-top: dashed 1px var(--ui-black-transparent);\\r\\n  padding-top: 10px;\\r\\n  display: flex;\\r\\n  justify-content: center;\\r\\n  align-items: center;\\r\\n}\\r\\n\\r\\n.paintGradientMakerPopupButtons {\\r\\n  margin-top: 1.5rem;\\r\\n}\\r\\n\\r\\n.paintGradientMakerPopupButtons button {\\r\\n  margin-left: 0.5rem;\\r\\n}\\r\\n\\r\\n.paintGradientMakerPopupButtons button:nth-of-type(1) {\\r\\n  color: black;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","module.exports = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 20 20\\\" fill=\\\"#855cd6\\\"><rect stroke=\\\"#000\\\" fill=\\\"#fff\\\" x=\\\".5\\\" y=\\\".5\\\" width=\\\"19\\\" height=\\\"19\\\" rx=\\\"4\\\" stroke-opacity=\\\".15\\\"/><path d=\\\"M13.35 8.8h-2.4V6.4a1.2 1.2 90 0 0-2.4 0l.043 2.4H6.15a1.2 1.2 90 0 0 0 2.4l2.443-.043L8.55 13.6a1.2 1.2 90 0 0 2.4 0v-2.443l2.4.043a1.2 1.2 90 0 0 0-2.4\\\"/></svg>\\n\"","export default \"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIyIDAgMjAgMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgZmlsbD0iIzg1NWNkNiI+PHBhdGggZD0iTTE4IDEwaC00VjZhMiAyIDAgMCAwLTQgMGwuMDcxIDRINmEyIDIgMCAwIDAgMCA0bDQuMDcxLS4wNzFMMTAgMThhMiAyIDAgMCAwIDQgMHYtNC4wNzFMMTggMTRhMiAyIDAgMCAwIDAtNCI+PC9wYXRoPjwvc3ZnPgo=\"","export default \"data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIyIDAgMjAgMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgZmlsbD0iIzg1NWNkNiI+PHBhdGggZD0iTSAxOCAxMCBoIC00IEggNiBhIDIgMiAwIDAgMCAwIDQgTCAxOCAxNCBhIDIgMiAwIDAgMCAwIC00Ij48L3BhdGg+PC9zdmc+Cg==\"","/* generated by pull.js */\r\nimport _js from \"./userscript.js\";\r\nimport _css from \"!css-loader!./style.css\";\r\nimport _asset from \"!raw-loader!./fill-complex-gradient-enabled.svg\";\r\nimport _asset2 from \"!url-loader!./add.svg\";\r\nimport _asset3 from \"!url-loader!./delete.svg\";\r\nexport const resources = {\r\n  \"userscript.js\": _js,\r\n  \"style.css\": _css,\r\n  \"fill-complex-gradient-enabled.svg\": _asset,\r\n  \"add.svg\": _asset2,\r\n  \"delete.svg\": _asset3,\r\n};\r\n","// Gradient Maker Addon\r\n// Original by: SharkPool\r\nexport default async function ({ addon, console, msg }) {\r\n    const customID = \"paintGradientMakerSelectButton\";\r\n    const symbolTag = Symbol(\"custom-gradient-tag\");\r\n\r\n    const paperLinkModes = new Set([\r\n        \"TEXT\", \"OVAL\", \"RECT\", \"ROUNDED_RECT\", \"TRIANGLE\", \"SUSSY\", \"ARROW\"\r\n    ]);\r\n\r\n    let selectedClassName, unselectedClassName, customBtn;\r\n    let observerUsed = false;\r\n    let modalStorage = {};\r\n\r\n    // Internal utils\r\n    function position2Angle(p1, p2) {\r\n        const dx = p1.x - p2.x;\r\n        const dy = p1.y - p2.y;\r\n        const angle = Math.atan2(dy, dx) * (180 / Math.PI);\r\n        return angle + 90;\r\n    }\r\n\r\n    function initGradSelectClasses(gradRow) {\r\n        const classes = {};\r\n        const children = Array.from(gradRow.children);\r\n        for (const child of children) {\r\n            const name = child.classList.toString();\r\n            if (classes[name] === undefined) classes[name] = 1;\r\n            else classes[name] = 0;\r\n        }\r\n\r\n        for (const [cls, count] of Object.entries(classes)) {\r\n            if (count) selectedClassName = cls;\r\n            else unselectedClassName = cls\r\n        }\r\n    }\r\n\r\n    function encodeGradHTML(settings) {\r\n        const sortedParts = [...settings.parts].sort((a, b) => a.p - b.p);\r\n\r\n        let gradString = settings.type === \"Linear\" ? \"linear-gradient(\" : \"radial-gradient(\";\r\n        if (settings.type === \"Linear\") gradString += `${settings.dir}deg, `;\r\n        for (const part of sortedParts) gradString += `${part.c} ${part.p}%, `;\r\n        return gradString.substring(0, gradString.length - 2) + \")\";\r\n    }\r\n\r\n    function genLinearGradPoints(bounds, angleDeg) {\r\n        const center = bounds.center;\r\n        const dir = new paper.Point({ angle: angleDeg, length: 1 });\r\n        const boundsRect = new paper.Path.Rectangle(bounds);\r\n        const gradLine = new paper.Path.Line({\r\n            from: center.subtract(dir.multiply(10000)),\r\n            to: center.add(dir.multiply(10000))\r\n        });\r\n\r\n        const intersections = gradLine.getIntersections(boundsRect);\r\n        gradLine.remove();\r\n        boundsRect.remove();\r\n        if (intersections.length < 2) {\r\n            return {\r\n                origin: center.subtract(dir.multiply(bounds.width / 2)),\r\n                destination: center.add(dir.multiply(bounds.width / 2))\r\n            };\r\n        } else {\r\n            return {\r\n                origin: intersections[0].point,\r\n                destination: intersections[1].point\r\n            };\r\n        }\r\n    }\r\n\r\n    function setSelected2Grad(settings) {\r\n        // Compile SVG-based gradient\r\n        const sortedParts = [...settings.parts].sort((a, b) => a.p - b.p);\r\n        const gradStops = sortedParts.map(part => new paper.GradientStop(part.c, part.p / 100));\r\n        const gradient = new paper.Gradient(gradStops, settings.type === \"Radial\");\r\n        modalStorage._gradCache = { settings, gradient };\r\n\r\n        paper.project.getSelectedItems().forEach((item) => {\r\n            let origin, destination;\r\n            if (settings.type === \"Radial\") {\r\n                origin = item.bounds.center;\r\n                destination = item.bounds.center.add([item.bounds.width / 2, 0]);\r\n            } else {\r\n                const points = genLinearGradPoints(item.bounds, settings.dir - 90);\r\n                origin = points.origin;\r\n                destination = points.destination;\r\n            }\r\n\r\n            item[settings.path] = { gradient, origin, destination };\r\n        });\r\n\r\n        // Update drawing & action\r\n        if (paper.tool.onUpdateImage) paper.tool.onUpdateImage();\r\n\r\n        // Set with HTML otherwise GUI will crash\r\n        const swatch = document.querySelectorAll(\r\n            `div[class^=color-button_color-button_] div[class^=color-button_color-button-swatch_]`\r\n        )[settings.path === \"fillColor\" ? 0 : 1];\r\n        if (swatch) swatch.style.background = encodeGradHTML(settings);\r\n    }\r\n\r\n    function paperGrad2CSS(paperGrad) {\r\n        const { gradient, origin, destination } = paperGrad;\r\n        if (!gradient || !origin || !destination) return null;\r\n\r\n        const stops = gradient.stops.map(s => `${s.color.toCSS(true)} ${Math.round(s.offset * 100)}%`);\r\n        if (gradient.radial) return `radial-gradient(circle, ${stops.join(\", \")})`;\r\n        else return `linear-gradient(${position2Angle(destination, origin)}deg, ${stops.join(\", \")})`;\r\n    }\r\n\r\n    function extractGradient(color) {\r\n        if (!color || !color.gradient) return {};\r\n        return {\r\n            gradient: color.gradient,\r\n            origin: color.origin || \"\",\r\n            destination: color.destination || color.highlight || \"\"\r\n        };\r\n    }\r\n\r\n    function decodeSelectedGrad(item, draggableDiv, settingsDiv) {\r\n        const { gradient, origin, destination } = extractGradient(item[modalStorage.path]);\r\n        if (!gradient || !origin || !destination) return draggableDiv.append(createDraggable(), createDraggable());\r\n\r\n        // Create draggables\r\n        const newStops = gradient.stops.map((s, i) => {\r\n            // \"offset\" will be undefined when using Scratch gradients, which dont have set-stops\r\n            const alpha = Math.round(s.color.alpha * 255).toString(16).padStart(2, \"0\");\r\n            return createDraggable(s.color.toCSS(true) + alpha, s.offset ? s.offset * 100 : i * 100)\r\n        });\r\n        draggableDiv.append(...newStops);\r\n\r\n        // Preset values\r\n        const angle = position2Angle(destination, origin);\r\n        settingsDiv.querySelector(\"select\").value = gradient.radial ? \"Radial\" : \"Linear\";\r\n        settingsDiv.querySelector(\"input\").value = angle;\r\n        modalStorage.type = gradient.radial ? \"Radial\" : \"Linear\";\r\n        modalStorage.dir = angle;\r\n    }\r\n\r\n    function decodeFromCache(settings, draggableDiv, settingsDiv) {\r\n        // Create draggables\r\n        const newStops = settings.parts.map((s, i) => {\r\n            // \"p\" will be NaN when using Scratch gradients, which dont have set-stops\r\n            return createDraggable(s.c, isNaN(s.p) ? i * 100 : s.p)\r\n        });\r\n        draggableDiv.append(...newStops);\r\n\r\n        // Preset values\r\n        settingsDiv.querySelector(\"select\").value = settings.type;\r\n        settingsDiv.querySelector(\"input\").value = settings.dir;\r\n        modalStorage.type = settings.type;\r\n        modalStorage.dir = settings.dir;\r\n    }\r\n\r\n    function handleFillEvent(paint) {\r\n        if (!modalStorage._gradCache) return;\r\n\r\n        // Set the GUI gradient mode to linear so we can position our gradients\r\n        paint.fillMode.gradientType = \"HORIZONTAL\";\r\n        paint.color.fillColor.gradientType = \"HORIZONTAL\";\r\n        paint.color.strokeColor.gradientType = \"HORIZONTAL\";\r\n\r\n        // Set the swatch color in case the GUI resets it\r\n        const swatch = document.querySelector(`div[class^=color-button_color-button_] div[class^=color-button_color-button-swatch_]`);\r\n        if (swatch) queueMicrotask(() => {\r\n            if (!modalStorage._gradCache) return;\r\n            swatch.style.background = encodeGradHTML(modalStorage._gradCache.settings);\r\n        });\r\n\r\n        const tool = paper.tool;\r\n        if (typeof tool?._getFillItem !== \"function\") return;\r\n\r\n        const item = tool._getFillItem();\r\n        if (!item) return;\r\n\r\n        const bounds = item.bounds;\r\n        let origin, destination;\r\n        if (modalStorage.type === \"Radial\") {\r\n            origin = new paper.Point(tool._point.x, tool._point.y);\r\n            destination = origin.add([Math.max(bounds.width, bounds.height) / 2, 0]);\r\n        } else {\r\n            const points = genLinearGradPoints(bounds, modalStorage.dir - 90);\r\n            origin = points.origin;\r\n            destination = points.destination;\r\n        }\r\n\r\n        const path = tool.fillProperty === \"fill\" ? \"fillColor\" : \"strokeColor\";\r\n        item[path] = {\r\n            gradient: modalStorage._gradCache.gradient,\r\n            origin, destination\r\n        };\r\n    }\r\n\r\n    function handleShapeModeEvent(type) {\r\n        if (!modalStorage._gradCache && type !== \"TEXT\") return;\r\n\r\n        // Set the swatch color in case the GUI resets it\r\n        const swatch = document.querySelector(`div[class^=color-button_color-button_] div[class^=color-button_color-button-swatch_]`);\r\n        if (swatch) queueMicrotask(() => {\r\n            if (!modalStorage._gradCache) return;\r\n            swatch.style.background = encodeGradHTML(modalStorage._gradCache.settings);\r\n        });\r\n\r\n        const tool = paper.tool;\r\n        if (typeof tool?._onMouseDrag !== \"function\") return;\r\n        if (tool[symbolTag]) return;\r\n        // Patch this event, if not already, to run our code\r\n\r\n        const funcName = type === \"TEXT\" ? \"onKeyDown\" : \"onMouseDrag\";\r\n        const ogOnFunc = tool[funcName];\r\n        tool[symbolTag] = true;\r\n        tool[funcName] = function (...args) {\r\n            ogOnFunc.call(this, ...args);\r\n\r\n            // Replace the fill with the custom gradient\r\n            if (!modalStorage._gradCache) {\r\n                if (type === \"TEXT\") {\r\n                    tool.element.style.background = \"\";\r\n                    tool.element.style.backgroundClip = \"\";\r\n                    tool.element.style.color = \"\";\r\n                }\r\n                return;\r\n            }\r\n\r\n            let item;\r\n            switch (type) {\r\n                case \"RECT\":\r\n                    item = this.rect;\r\n                    break;\r\n                case \"OVAL\":\r\n                    item = this.oval;\r\n                    break;\r\n                case \"TEXT\":\r\n                    item = this.textBox;\r\n                    break;\r\n                case \"ROUNDED_RECT\":\r\n                    item = this.rect;\r\n                    break;\r\n                case \"TRIANGLE\":\r\n                    item = this.tri;\r\n                    break;\r\n                case \"SUSSY\":\r\n                    item = this.sussy;\r\n                    break;\r\n                case \"ARROW\":\r\n                    item = this.tri;\r\n                    break;\r\n                default: return;\r\n            }\r\n            if (!item) return;\r\n            const bounds = item.bounds;\r\n            let origin, destination;\r\n            if (modalStorage.type === \"Radial\") {\r\n                origin = item.bounds.center;\r\n                destination = item.bounds.center.add([item.bounds.width / 2, 0]);\r\n            } else {\r\n                const points = genLinearGradPoints(bounds, modalStorage.dir - 90);\r\n                origin = points.origin;\r\n                destination = points.destination;\r\n            }\r\n\r\n            item.fillColor = {\r\n                gradient: modalStorage._gradCache.gradient,\r\n                origin, destination\r\n            };\r\n\r\n            // Text uses HTML elements, so we have to handle that too\r\n            if (type === \"TEXT\") {\r\n                tool.element.style.background = encodeGradHTML(modalStorage._gradCache.settings);\r\n                tool.element.style.backgroundClip = \"text\";\r\n                tool.element.style.color = \"transparent\";\r\n            }\r\n        }\r\n    }\r\n\r\n    // GUI utils\r\n    function showSelectedGrad(item) {\r\n        const [fillSwatch, outlineSwatch] = document.querySelectorAll(`div[class^=color-button_color-button_] div[class^=color-button_color-button-swatch_]`);\r\n        const outCSSGrad = paperGrad2CSS(extractGradient(item.strokeColor));\r\n        if (outlineSwatch) {\r\n            if (outCSSGrad) outlineSwatch.style.background = outCSSGrad;\r\n            else if (!item.strokeColor || item.strokeWidth === 0) outlineSwatch.style.background = \"#fff\";\r\n        }\r\n\r\n        const fillGrad = extractGradient(item.fillColor);\r\n        const fillCSSGrad = paperGrad2CSS(fillGrad);\r\n        modalStorage._gradCache = undefined;\r\n        if (fillSwatch) {\r\n            if (fillCSSGrad) {\r\n                fillSwatch.style.background = fillCSSGrad;\r\n\r\n                // Update cache\r\n                const { gradient, destination, origin } = fillGrad;\r\n                modalStorage._gradCache = {\r\n                    gradient,\r\n                    settings: {\r\n                        type: gradient.radial ? \"Radial\" : \"Linear\",\r\n                        dir: position2Angle(destination, origin),\r\n                        parts: gradient.stops.map(s => {\r\n                            const alpha = Math.round(s.color.alpha * 255).toString(16).padStart(2, \"0\");\r\n                            return { c: s.color.toCSS(true) + alpha, p: s.offset * 100 };\r\n                        })\r\n                    }\r\n                };\r\n            } else if (!item.fillColor) fillSwatch.style.background = \"#fff\";\r\n        }\r\n    }\r\n\r\n    function createDraggable(optC, optP) {\r\n        const index = modalStorage.parts.length;\r\n        const rngPos = optP ?? Math.floor(Math.random() * 100);\r\n        const rngHex = optC ?? `#${Math.floor(Math.random() * Math.pow(2, 24)).toString(16).padStart(6, \"0\")}ff`;\r\n        const opacity = optC ? optC.length === 9 ? parseInt(optC.slice(7, 9), 16) / 255 : 1 : 1;\r\n\r\n        const draggable = document.createElement(\"div\");\r\n        draggable.id = index;\r\n        draggable.classList.add(\"pointer\");\r\n        draggable.setAttribute(\"style\", `cursor: pointer; width: 25px; position: absolute; top: -6px; transform: translateX(-50%);`);\r\n        draggable.style.left = `${rngPos}%`;\r\n\r\n        const nub = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\r\n        nub.setAttribute(\"width\", \"14\");\r\n        nub.setAttribute(\"height\", \"7\");\r\n        nub.style.transform = \"translateX(45%)\";\r\n\r\n        const polygon = document.createElementNS(\"http://www.w3.org/2000/svg\", \"polygon\");\r\n        polygon.setAttribute(\"points\", \"0,7 7,0 14,7\");\r\n        polygon.setAttribute(\"stroke\", \"#fff\");\r\n        polygon.setAttribute(\"fill\", \"#fff\");\r\n        nub.appendChild(polygon);\r\n\r\n        const color = document.createElement(\"div\");\r\n        color.setAttribute(\"style\", `width: 25px; height: 25px; border-radius: 4px; background: #fff; display: flex; justify-content: center; align-items: center; flex-direction: column;`);\r\n\r\n        const colorContainer = document.createElement(\"div\");\r\n        colorContainer.setAttribute(\"style\", `width: 16px; height: 16px; border-radius: 5px; background: ${rngHex}; border: solid 1px var(--ui-black-transparent); margin-bottom: 2px;`);\r\n\r\n        const colorInput = document.createElement(\"input\");\r\n        colorInput.setAttribute(\"type\", \"color\");\r\n        colorInput.setAttribute(\"style\", `opacity: 0; position: absolute; pointer-events: none;`);\r\n\r\n        const opacityInput = document.createElement(\"input\");\r\n        opacityInput.setAttribute(\"type\", \"number\");\r\n        opacityInput.setAttribute(\"min\", \"0\");\r\n        opacityInput.setAttribute(\"max\", \"100\");\r\n        opacityInput.value = opacity * 100;\r\n        opacityInput.setAttribute(\"style\", `visibility: hidden; background: #fff; border: none; color: #000; text-align: center; position: absolute; pointer-events: auto; width: 45px; height: 25px; padding: 0; margin: 0; border-radius: 0 5px 5px 0; left: 22px;`);\r\n        if (rngPos > 50) {\r\n            opacityInput.style.removeProperty(\"left\");\r\n            opacityInput.style.right = \"22px\";\r\n            opacityInput.style.borderRadius = \"5px 0 0 5px\";\r\n        }\r\n\r\n        // Color picker handler\r\n        colorContainer.addEventListener(\"click\", (e) => {\r\n            opacityInput.style.visibility = \"visible\";\r\n            colorInput.click();\r\n            e.stopPropagation();\r\n        });\r\n        draggable.addEventListener(\"mouseleave\", (e) => {\r\n            opacityInput.style.visibility = \"hidden\";\r\n            e.stopPropagation();\r\n        });\r\n\r\n        colorInput.addEventListener(\"input\", (e) => {\r\n            const alpha = modalStorage.parts[index].c.substring(7, 9);\r\n            modalStorage.parts[index].c = e.target.value + alpha;\r\n            colorContainer.style.background = e.target.value + alpha;\r\n            updateDisplay();\r\n        });\r\n\r\n        // Opacity slider handler\r\n        opacityInput.addEventListener(\"click\", (e) => {\r\n            opacityInput.focus();\r\n            e.stopPropagation();\r\n        });\r\n        opacityInput.addEventListener(\"input\", (e) => {\r\n            const newOpacity = Math.min(100, Math.max(0, e.target.value));\r\n            e.target.value = newOpacity;\r\n\r\n            const alpha = Math.round(newOpacity * 2.55).toString(16).padStart(2, \"0\");\r\n            const hex = modalStorage.parts[index].c;\r\n            modalStorage.parts[index].c = hex.substring(0, 7) + alpha;\r\n            colorContainer.style.background = hex.substring(0, 7) + alpha;\r\n            updateDisplay();\r\n        });\r\n\r\n        draggable.addEventListener(\"mousedown\", (e) => {\r\n            e.preventDefault();\r\n            if (e.target === opacityInput) return;\r\n\r\n            modalStorage.selectedPointer = draggable;\r\n            const container = draggable.parentElement;\r\n            const containerRect = container.getBoundingClientRect();\r\n\r\n            const onMouseMove = (moveEvent) => {\r\n                const x = moveEvent.clientX - containerRect.left;\r\n                const percent = Math.min(100, Math.max(0, (x / container.offsetWidth) * 100));\r\n                draggable.style.left = `${percent}%`;\r\n                if (percent > 50) {\r\n                    opacityInput.style.removeProperty(\"left\");\r\n                    opacityInput.style.right = \"22px\";\r\n                    opacityInput.style.borderRadius = \"5px 0 0 5px\";\r\n                } else {\r\n                    opacityInput.style.left = \"22px\";\r\n                    opacityInput.style.removeProperty(\"right\");\r\n                    opacityInput.style.borderRadius = \"0 5px 5px 0\";\r\n                }\r\n                modalStorage.parts[index].p = percent;\r\n                updateDisplay();\r\n            };\r\n\r\n            const onMouseUp = () => {\r\n                document.removeEventListener(\"mousemove\", onMouseMove);\r\n                document.removeEventListener(\"mouseup\", onMouseUp);\r\n            };\r\n\r\n            document.addEventListener(\"mousemove\", onMouseMove);\r\n            document.addEventListener(\"mouseup\", onMouseUp);\r\n        });\r\n\r\n        color.append(colorContainer, colorInput, opacityInput);\r\n        draggable.append(nub, color);\r\n        modalStorage.parts.push({ c: rngHex, p: rngPos });\r\n        modalStorage.selectedPointer = draggable;\r\n        return draggable;\r\n    }\r\n\r\n    function updateDisplay() {\r\n        const display = document.querySelector(\".paintGradientMakerPopupDisplay\");\r\n        if (display) display.style.background = encodeGradHTML(modalStorage);\r\n    }\r\n\r\n    // Main GUI\r\n    function openGradientMaker() {\r\n        function genSettingsTable(div) {\r\n            const btnStyle = `width: 35px; height: 35px; border: solid 1px var(--ui-black-transparent, hsla(0, 0%, 0%, 0.15)); border-radius: 5px; background: var(--paint-input-background, --ui-primary, #fff); transition: transform 0.2s;`;\r\n            const selectStlye = `cursor: pointer; height: 30px; margin: 5px; border: solid 1px var(--ui-black-transparent); border-radius: 5px; background: var(--ui-secondary);`;\r\n            const directionStyle = `width: 50px; height: 30px; margin: 5px; border: solid 1px var(--ui-black-transparent); border-radius: 5px; background: var(--ui-secondary);`;\r\n\r\n            const createBtn = document.createElement(\"button\");\r\n            createBtn.setAttribute(\"style\", btnStyle);\r\n            createBtn.addEventListener(\"click\", (e) => {\r\n                draggables.appendChild(createDraggable());\r\n                updateDisplay();\r\n                e.stopPropagation();\r\n            });\r\n\r\n            const addIcon = addon.tab.recolorable();\r\n            addIcon.draggable = false;\r\n            addIcon.src = addon.self.getResource(\"/add.svg\") /* rewritten by pull.js */;\r\n            createBtn.appendChild(addIcon);\r\n\r\n            const deleteBtn = document.createElement(\"button\");\r\n            deleteBtn.setAttribute(\"style\", btnStyle);\r\n            deleteBtn.style.margin = \"0px 8px\";\r\n            deleteBtn.addEventListener(\"click\", (e) => {\r\n                const pointer = modalStorage.selectedPointer;\r\n                if (pointer) {\r\n                    delete modalStorage.selectedPointer;\r\n                    modalStorage.parts.splice(pointer.id, 1);\r\n                    const cache = {\r\n                        parts: modalStorage.parts,\r\n                        type: modalStorage.type,\r\n                        dir: modalStorage.dir,\r\n                    };\r\n                    modalStorage.parts = [];\r\n                    draggables.innerHTML = \"\";\r\n                    decodeFromCache(cache, draggables, settings);\r\n                    updateDisplay();\r\n                }\r\n                e.stopPropagation();\r\n            });\r\n\r\n            const deleteIcon = addon.tab.recolorable();\r\n            deleteIcon.draggable = false;\r\n            deleteIcon.src = addon.self.getResource(\"/delete.svg\") /* rewritten by pull.js */;\r\n            deleteBtn.appendChild(deleteIcon);\r\n\r\n            const title1 = document.createElement(\"span\");\r\n            title1.textContent = \"Gradient Type:\";\r\n\r\n            const select = document.createElement(\"select\");\r\n            select.setAttribute(\"style\", selectStlye);\r\n\r\n            const option1 = document.createElement(\"option\");\r\n            const option2 = document.createElement(\"option\");\r\n            option1.text = \"Linear\"; option1.value = \"Linear\";\r\n            option2.text = \"Radial\"; option2.value = \"Radial\";\r\n            select.append(option1, option2);\r\n            select.addEventListener(\"change\", (e) => {\r\n                modalStorage.type = e.target.value;\r\n                updateDisplay();\r\n                e.stopPropagation();\r\n            });\r\n\r\n            const title2 = document.createElement(\"span\");\r\n            title2.textContent = \"Direction:\";\r\n\r\n            const dirBtn = document.createElement(\"input\");\r\n            dirBtn.setAttribute(\"style\", directionStyle);\r\n            dirBtn.setAttribute(\"type\", \"number\");\r\n            dirBtn.setAttribute(\"max\", 360);\r\n            dirBtn.setAttribute(\"min\", 0);\r\n            dirBtn.setAttribute(\"value\", 90);\r\n            dirBtn.addEventListener(\"input\", (e) => {\r\n                modalStorage.dir = e.target.value;\r\n                updateDisplay();\r\n                e.stopPropagation();\r\n            });\r\n\r\n            div.append(createBtn, deleteBtn, title1, select, title2, dirBtn);\r\n        }\r\n\r\n        const paint = ReduxStore.getState().scratchPaint;\r\n        const oldCache = modalStorage._gradCache;\r\n        modalStorage = {\r\n            parts: [], type: \"Linear\", dir: 90, selectedPointer: undefined,\r\n            path: paint.modals.fillColor ? \"fillColor\" : \"strokeColor\",\r\n        };\r\n\r\n        const { backdrop, container, content, closeButton, remove } = addon.tab.createModal(\"Complex Gradient\", {\r\n            isOpen: true,\r\n            useEditorClasses: true,\r\n        });\r\n        container.classList.add(\"paintGradientMakerPopup\");\r\n        content.classList.add(\"paintGradientMakerPopupContent\");\r\n\r\n        backdrop.addEventListener(\"click\", remove);\r\n        closeButton.addEventListener(\"click\", remove);\r\n\r\n        const buttonRow = Object.assign(document.createElement(\"div\"), {\r\n            className: addon.tab.scratchClass(\"prompt_button-row\", { others: \"paintGradientMakerPopupButtons\" }),\r\n        });\r\n        const cancelButton = Object.assign(document.createElement(\"button\"), {\r\n            textContent: \"Cancel\",\r\n        });\r\n        cancelButton.addEventListener(\"click\", remove, { once: true });\r\n        buttonRow.appendChild(cancelButton);\r\n        const startButton = Object.assign(document.createElement(\"button\"), {\r\n            textContent: \"OK\",\r\n            className: addon.tab.scratchClass(\"prompt_ok-button\"),\r\n        });\r\n        startButton.addEventListener(\r\n            \"click\",\r\n            () => {\r\n                setSelected2Grad(modalStorage);\r\n                remove();\r\n            },\r\n            { once: true },\r\n        );\r\n        buttonRow.appendChild(startButton);\r\n\r\n        // Color display\r\n        const display = document.createElement(\"div\");\r\n        display.classList.add(\"paintGradientMakerPopupDisplay\");\r\n\r\n        // Draggables space\r\n        const draggables = document.createElement(\"div\");\r\n        draggables.classList.add(\"paintGradientMakerPopupDraggables\");\r\n\r\n        // Settings\r\n        const settings = document.createElement(\"div\");\r\n        settings.classList.add(\"paintGradientMakerPopupSettings\");\r\n        genSettingsTable(settings);\r\n\r\n        content.append(display, draggables, settings, buttonRow);\r\n\r\n        if (paint.selectedItems?.length) decodeSelectedGrad(paint.selectedItems[0], draggables, settings);\r\n        else if (oldCache) decodeFromCache(oldCache.settings, draggables, settings);\r\n        else draggables.append(createDraggable(), createDraggable());\r\n        updateDisplay();\r\n    }\r\n\r\n    function startListenerWorker() {\r\n        let lastMode, lastSelected, lastModals;\r\n        ReduxStore.subscribe(() => {\r\n            const paint = ReduxStore.getState().scratchPaint;\r\n            if (!paint || paint?.format === undefined || paint?.format === null) return;\r\n            const { mode, selectedItems, modals } = paint;\r\n\r\n            // No bitmap support\r\n            if (paint.format.startsWith(\"BITMAP\")) {\r\n                if (customBtn) {\r\n                    customBtn.remove();\r\n                    customBtn = undefined;\r\n                }\r\n                return;\r\n            }\r\n\r\n            // Run relative tool events\r\n            if (mode === \"FILL\") handleFillEvent(paint);\r\n            else if (paperLinkModes.has(mode)) handleShapeModeEvent(mode);\r\n\r\n            const idChain = selectedItems.map((e) => e.id).join(\".\");\r\n            const modalChain = `${modals.fillColor}${modals.strokeColor}`;\r\n            if (mode === lastMode && idChain === lastSelected && modalChain === lastModals) return;\r\n            lastMode = mode;\r\n            lastSelected = idChain;\r\n            lastModals = modalChain;\r\n\r\n            // Decode potential custom gradients\r\n            if (selectedItems?.length) showSelectedGrad(selectedItems[0]);\r\n            else if (mode === \"SELECT\" || mode === \"RESHAPE\") modalStorage._gradCache = undefined;\r\n\r\n            // Add custom modal\r\n            if (!modals.strokeColor && !modals.fillColor) return;\r\n            if (observerUsed) return;\r\n            const observer = new MutationObserver(() => {\r\n                const gradRow = document.querySelector(`div[class^=\"color-picker_gradient-picker-row_\"]`);\r\n                if (!gradRow || gradRow.lastElementChild.id === customID) return;\r\n\r\n                // Get the appropriate class names for selected items\r\n                if (!selectedClassName) initGradSelectClasses(gradRow);\r\n                const children = Array.from(gradRow.children);\r\n\r\n                let selectIcon = addon.self.getResource(\"/fill-complex-gradient-enabled.svg\") /* rewritten by pull.js */;\r\n                selectIcon = \"data:image/svg+xml;base64,\" + btoa(selectIcon.replace(\r\n                    \"#855cd6\",\r\n                    document.documentElement.style.getPropertyValue(\"--looks-secondary\"),\r\n                ));\r\n  \r\n                customBtn = children[0].cloneNode(true);\r\n                customBtn.src = selectIcon;\r\n                customBtn.id = customID;\r\n                customBtn.setAttribute(\"class\", unselectedClassName);\r\n                gradRow.appendChild(customBtn);\r\n\r\n                gradRow.addEventListener(\"click\", (e) => {\r\n                    if (e.target === customBtn) {\r\n                        for (const child of children) child.setAttribute(\"class\", unselectedClassName);\r\n                        customBtn.setAttribute(\"class\", selectedClassName);\r\n                        openGradientMaker();\r\n                    } else if (e.target.nodeName === \"IMG\") {\r\n                        modalStorage._gradCache = undefined;\r\n                        customBtn.setAttribute(\"class\", unselectedClassName);\r\n                    }\r\n                });\r\n\r\n                observerUsed = false;\r\n                observer.disconnect();\r\n            });\r\n\r\n            observer.observe(document.body, { childList: true, subtree: true });\r\n            observerUsed = true;\r\n        });\r\n    }\r\n\r\n    if (typeof scaffolding === \"undefined\") startListenerWorker();\r\n}\r\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACZA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAKA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;;;;A","sourceRoot":""}